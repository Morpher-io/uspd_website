# Contract Deployment Strategy

This document outlines the deployment strategy for the USPD protocol contracts, primarily managed by the Foundry script located at `contracts/script/Token.s.sol`.

## Deterministic Token Addresses (CREATE2)

A key goal for USPD is to have consistent token addresses across all supported EVM chains. This simplifies user experience and integration, as users only need to remember one address for `USPDToken` and `cUSPDToken` regardless of the network.

To achieve this, the core token contracts (`cUSPDToken.sol` and `UspdToken.sol`) are deployed using the **CREATE2** opcode via the [CreateX](https://github.com/pcaversaccio/createx) minimal proxy factory (`0xba5Ed099633D3B313e4D5F7bdc1305d3c28ba5Ed`).

### Why CREATE2?

CREATE2 allows for counterfactual contract deployment, meaning the address of a contract can be determined *before* it's deployed, based on the deployer's address, a salt (derived from the deployer address and an identifier in our script), and the contract's creation bytecode hash.

We specifically chose CREATE2 over alternatives like CREATE3 for its **open deployment scheme**. While CREATE3 can also provide deterministic addresses, CREATE2 allows *anyone* to deploy the exact same bytecode with the same salt (derived from *their* address) and achieve the same resulting contract address on a new chain, provided the CreateX factory exists there. This aligns with our goal of facilitating permissionless expansion to new chains.

**Note:** While the addresses are deterministic, integrating USPD with cross-chain bridges still requires specific configuration and potentially governance actions by the bridge providers.

## Upgradeable Core Contracts (Proxies)

Several core logic contracts are designed to be upgradeable to allow for bug fixes and future enhancements. These contracts utilize the **Transparent Upgradeable Proxy (TUP)** pattern:

*   `PriceOracle.sol`
*   `StabilizerNFT.sol`
*   `OvercollateralizationReporter.sol`

The deployment script (`Token.s.sol`) deploys both the implementation logic contract and a `TransparentUpgradeableProxy` contract that points to it. User interactions occur with the proxy address, which delegates calls to the current implementation.

## Proxy Administration & Future Governance

Currently, the upgrades for these proxies are managed by a central `ProxyAdmin` contract, controlled by the core development team (PermissionLess).

However, the long-term vision is to decentralize control. The plan is to transition the administration of these proxies, along with other critical administrative roles, to a **robust on-chain governance system**. This system is currently under development, and the transition will occur once the core protocol functionality is deemed feature-complete and stable. A specific timeline for this transition cannot be provided at this stage.

## Access Control & Role Management

The contracts utilize OpenZeppelin's `AccessControl` pattern for managing permissions. Key roles include:

*   `DEFAULT_ADMIN_ROLE`: Has broad permissions, including granting/revoking other roles and managing contract upgrades (via `ProxyAdmin`).
*   `UPDATER_ROLE` (`cUSPDToken`, `OvercollateralizationReporter`): Allows updating critical contract dependencies like the Oracle or Stabilizer addresses.
*   `MINTER_ROLE` (`StabilizerNFT`): Allows minting new Stabilizer NFTs.
*   `SIGNER_ROLE` (`PriceOracle`): Authorizes addresses to submit signed price attestations.
*   *Other specific roles may exist within individual contracts.*

Initially, the `DEFAULT_ADMIN_ROLE` is typically assigned to the deployer address or the core team multisig. As part of the move towards decentralization and increased security post-launch, the plan is to either:

1.  **Renounce** the `DEFAULT_ADMIN_ROLE` by transferring it to `address(0)`.
2.  **Transfer** the `DEFAULT_ADMIN_ROLE` to the future on-chain governance contract.

This action will be taken once the team is confident that no further administrative interventions are expected for the core contract logic.

## Open Source & Verification

Transparency and security are paramount.
*   The source code for both the smart contracts and the frontend interface is **open-source** and available in our public repositories (links to be added).
*   We strive to **verify the source code** of all deployed contracts on block explorers (like Etherscan) for each supported chain.
*   The use of **deterministic addresses** via CREATE2 further enhances transparency, allowing users to easily verify they are interacting with the correct USPD token contracts across different networks.
